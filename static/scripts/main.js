var upload_form = document.getElementById("upload-form");
var loader = document.getElementById("loader");
var fader = document.getElementById("fader");
var init = document.getElementById("init");
var msg = document.getElementById("message");

upload_form.addEventListener("submit", function (event) {
    event.preventDefault();

    submit_btn.disabled = true;
    loader.style.display = "block";
    fader.style.opacity = 0;
    init.style.display = "none";

    const formData = new FormData(upload_form);
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/', true);
    xhr.onload = function () {
        if (xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            if (response.success) {
                upload_form.reset();
                console.log(response);

                submit_btn.disabled = false;
                loader.style.display = "none";
                fader.style.opacity = 1;

                update_display(response.results.prediction, response.results.confidence);
            } else {
                alert("Error uploading file.");
            }
        } else {
            alert('An Internal error occurred.');
        }
    };
    xhr.send(formData);
});

// Function to update the display
function update_display(family, confidence) {
    var result = document.getElementById("result");
    var word = ''
    if (confidence > 95) {
        word = "very likely";
    } else if (confidence > 70) {
        word = "likely";
    } else {
        word = "possible";
    }

    result.innerHTML = "It is <b>" + word + "</b> that the malware belongs to the <b>" + family 
                        + "</b> family with a confidence of <b>" + confidence + "%</b>.";
}