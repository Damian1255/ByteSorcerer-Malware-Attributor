import os
from app import app
from flask import jsonify
from werkzeug.utils import secure_filename

# Process the file from the request and save it
def process_file_from_request(request):
    for item in request.files.getlist('file'):
        if item:
            imagename = secure_filename(item.filename)

            # Check if the file is blacklisted
            if '.' in imagename and imagename.rsplit('.', 1)[1].lower() in app.config['BLACKLISTED_EXTENSION']:
                message = """The file uploaded is not supported.
                            Ensure you are uploading an Portable Executable file."""
                return {'valid': False, 'message': message}
        
            # Save the file for processing
            item.save(os.path.join(app.config['UPLOAD_FOLDER'], imagename))

            return {'valid': True, 'filename': imagename}
        else:
            return {'valid': False, 'message': 'No file is uploaded.'}
        

def clear_upload_if_exists(filename):
    if os.path.exists(filename):
        os.remove(filename)